# Содержание
<!-- TOC -->
- [Содержание](#Содержание)
- [Назначение](#Сервис-Advertising)
- [Требования](#Требования)
- [Архитектура](#Архитектура)
- [Запуск проекта](#Запуск-проекта)
- [Структура проекта](#Структура-проекта)
- [Документация методов API](#Документация-методов-API)
    - [CREATE](#**CREATE**)
    - [LIST](#**LIST**)
    - [GET](#**GET**)

# Сервис Advertising

Результат
выполнения [тестового задания для backend-стажёра в команду Advertising](https://github.com/avito-tech/adv-backend-trainee-assignment)

Сервис выполняет функцию выдачи списка объявлений, просмотра и добавления нового объявления

### Требования

* Для запуска сервиса необходимо наличие запущенного сервера БД Postgres.
* Для локального запуска потребуется наличие Docker.

### Архитектура

Взаимодействие с сервисом происходит посредством использования REST-API. Сервис обрабатывает входящие запросы, и для
каждого из них определяет, какой из обработчиков вызывать. Каждый из обработчиков реализует определенную бизнес-логику и
использует репозиторий для взаимодействий с БД. По завершению работы обработчика, в ответ на запрос записываем результат
в формате JSON.

### Запуск проекта

Для локального запуска проекта достаточно выполнить команду из корня проекта:
```bash
docker-compose up -d
```
Данная команда выполнит сборку контейнера с сервисом, с последующим его запуском.
БД можно заполнить тестовыми данными выполнив команду:
```bash
make testdata
```
PS: Postgres создаётся с пользователем и паролем: 'postgres' и базой 'ad'

### Структура проекта

| DIR | Описание |
| ------ | ------ |
|cmd/ad-service| код запускающей сервис|
|config| содержит конфигурационный файл сервиса|
|migrations| файлы миграции |
|internal/ad| обработчики сервиса |
|internal/config| пакет конфигураций |
|internal/model| репозиторий для работы с БД |
|internal/pagination| пакет для работы с пагинацией|

## Документация методов API

Все ссылки относительны *http://localhost:8080*

|Method | HTTP request | Description |
|------------- | ------------- | ------------- |
|[**CREATE**](#**CREATE**) | **POST** /ad | создание объявления |
|[**LIST**](#**LIST**) | **GET** /ad | список объявлений |
|[**GET**](#**GET**) | **GET** /ad/{id} | получение объявления |

### **CREATE**
Создание объявления

##### Тело запроса
```json
{
  "title": "title1",
  "description": "description",
  "price": 500,
  "photo_links": ["https://picsum.photos/200", "https://picsum.photos/200"]
}
```
##### Ответ
```json
{
    "success": true,
    "id": 14
}
```


### **LIST**
Создание объявления

##### Параметры

| Имя | Тип | Описание  |
| ------------- | ------------- | ------------- |
| **sort_by** | **String**| Параметр сортировки по полю. Принимаются варианты price или created, для сортировки по убыванию, к соответствующему варианту добавляется знак "-". |

##### Ответ
```json
{
  "success": true,
  "pagination": {
    "limit": 10,
    "total_count": 14,
    "current_page": 1,
    "total_page_count": 2
  },
  "ads": [
    {
      "id": 1,
      "title": "title 1 ",
      "price": 500,
      "photo_main": "https://picsum.photos/200"
    },
    ...
    {
      "id": 10,
      "title": "title 10",
      "price": 1000,
      "photo_main": "https://picsum.photos/200"
    }
  ]
}
```

### **GET**
Получение объявления по идентификатору

### Параметры

| Имя | Тип | Описание  |
| ------------- | ------------- | ------------- |
| **fields** | **String**| список опциональных полей разделенных запятой. Возможные значения **desc** или **photos** |

##### Ответ
```json
{
  "success": true,
  "ad": {
    "id": 14,
    "created_at": "2021-02-04T09:16:21.59119Z",
    "title": "title 14",
    "description": "description 14",
    "price": 500,
    "photo_links": [
      "https://picsum.photos/200",
      "https://picsum.photos/200"
    ],
    "photo_main": "https://picsum.photos/200"
  }
}
```
